<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mNAV Calculator (with Duration)</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        .slider-container { margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; }
        input[type="range"] { width: 100%; }
        .value { font-weight: bold; }
        #result { margin-top: 30px; padding: 15px; background: #f0f0f0; border-radius: 5px; }
        #range { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>mNAV Interactive Model (Finite Duration)</h1>
    <p>Adjust the sliders to play with the variables. Now includes finite duration (n years): <br>
    Fair mNAV = 1 + ((g - c) / k) × (1 - (1 + k)^(-n)) × (D/A)</p>
    <p>Values are in percentages (e.g., 30 for 30%). For perpetual (pref-heavy), set n high (e.g., 50+). Negative premiums show as discounts. Defaults match ~2.8x case (c=0, k=5%).</p>

    <div class="slider-container">
        <label for="g">Expected BTC Return (g): <span id="g-value" class="value">30%</span></label>
        <input type="range" id="g" min="0" max="50" value="30" step="1">
    </div>

    <div class="slider-container">
        <label for="c">Cost of Borrowing (c): <span id="c-value" class="value">0%</span></label>
        <input type="range" id="c" min="0" max="20" value="0" step="1">
    </div>

    <div class="slider-container">
        <label for="k">Discount Rate (k): <span id="k-value" class="value">5%</span></label>
        <input type="range" id="k" min="1" max="30" value="5" step="1">
    </div>

    <div class="slider-container">
        <label for="da">Amplification Ratio (D/A): <span id="da-value" class="value">30%</span></label>
        <input type="range" id="da" min="0" max="50" value="30" step="1">
    </div>

    <div class="slider-container">
        <label for="n">Remaining Duration (n) in Years: <span id="n-value" class="value">50</span></label>
        <input type="range" id="n" min="1" max="50" value="50" step="1">
    </div>

    <div id="result">
        <h2>Calculated Fair mNAV: <span id="mnav">2.80</span></h2>
        <p>Premium/Discount: <span id="premium">180%</span></p>
    </div>

    <div id="range">
        <h3>Example Ranges (with n=50 for perpetual)</h3>
        <p>Conservative (g=20%, c=10%, k=18%): mNAV ≈ 1.13 (13% premium)</p>
        <p>Base Case (g=30%, c=0%, k=5%): mNAV ≈ 2.80 (180% premium)</p>
        <p>Finite 10Y (g=30%, c=0%, k=5%): mNAV ≈ 1.69 (69% premium)</p>
    </div>

    <script>
        const sliders = {
            g: document.getElementById('g'),
            c: document.getElementById('c'),
            k: document.getElementById('k'),
            da: document.getElementById('da'),
            n: document.getElementById('n')
        };

        const values = {
            g: document.getElementById('g-value'),
            c: document.getElementById('c-value'),
            k: document.getElementById('k-value'),
            da: document.getElementById('da-value'),
            n: document.getElementById('n-value')
        };

        function updateValues() {
            Object.keys(sliders).forEach(key => {
                if (key === 'n') {
                    values[key].textContent = sliders[key].value;
                } else {
                    values[key].textContent = `${sliders[key].value}%`;
                }
            });
            calculate();
        }

        function calculate() {
            const g = sliders.g.value / 100;
            const c = sliders.c.value / 100;
            const k = sliders.k.value / 100;
            const da = sliders.da.value / 100;
            const n = parseInt(sliders.n.value);

            if (k === 0) {
                mnavDisplay.textContent = 'Invalid (k=0)';
                premiumDisplay.textContent = 'N/A';
                return;
            }

            const excess = g - c;
            const annuityFactor = (1 - Math.pow(1 + k, -n)) / k;
            const multiplier = excess * annuityFactor;
            const mnav = 1 + (multiplier * da);
            const premium = ((mnav - 1) * 100).toFixed(0);

            mnavDisplay.textContent = mnav.toFixed(2);
            premiumDisplay.textContent = premium >= 0 ? `${premium}% premium` : `${Math.abs(premium)}% discount`;
        }

        const mnavDisplay = document.getElementById('mnav');
        const premiumDisplay = document.getElementById('premium');

        Object.values(sliders).forEach(slider => {
            slider.addEventListener('input', updateValues);
        });

        updateValues(); // Initial update
    </script>

    <p>To use: Save this as an .html file and open in your browser. Sliders update in real-time.</p>
</body>
</html>
