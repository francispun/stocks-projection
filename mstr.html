<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSTR BTC Leverage Simulator</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #000000;
            color: #f7931a;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        h1 {
            text-align: center;
            color: #f7931a;
            text-shadow: 0 0 10px #f7931a;
            margin-bottom: 20px;
            font-size: 2.5em;
        }
        .container {
            background: #1a1a1a;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(247, 147, 26, 0.3);
            width: 100%;
            max-width: 900px;
        }
        .controls {
            margin-bottom: 30px;
        }
        .control-group {
            margin-bottom: 25px;
            padding: 15px;
            background: #2a2a2a;
            border-radius: 10px;
            border: 1px solid #f7931a;
        }
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #f7931a;
            font-size: 1.1em;
        }
        input[type="range"], input[type="number"], input[type="checkbox"] {
            width: 100%;
            margin-bottom: 10px;
            accent-color: #f7931a;
        }
        .value-display {
            font-size: 1.2em;
            color: #ffffff;
            font-weight: bold;
            text-align: center;
            padding: 5px;
            background: #333333;
            border-radius: 5px;
            display: inline-block;
        }
        .selected-factor {
            background: #333333;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.5em;
            color: #f7931a;
            border: 1px solid #f7931a;
        }
        .selected-factor span {
            color: #ffffff;
            font-weight: bold;
        }
        .result {
            padding: 20px;
            border-radius: 10px;
            background: #2a2a2a;
            border: 1px solid #f7931a;
            overflow-x: auto;
        }
        table {
            width: 100%;
            min-width: 600px;
            border-collapse: collapse;
            margin-top: 15px;
            background: #1a1a1a;
            table-layout: fixed;
        }
        th, td {
            border: 2px solid #f7931a;
            padding: 12px;
            text-align: center;
            color: #e68a00;
            font-weight: bold;
            font-size: 1.0em;
        }
        th {
            background-color: #333333;
            font-size: 1.1em;
        }
        .orange-value {
            background-color: #f7931a;
            color: #000000;
            font-weight: bold;
        }
        .yellow-value {
            background-color: #ffff00;
            color: #000000;
            font-weight: bold;
        }
        caption {
            font-weight: bold;
            margin-bottom: 10px;
            color: #f7931a;
            font-size: 1.2em;
        }
        p {
            color: #ffffff;
            font-size: 0.9em;
            margin-top: 10px;
        }
        .instruction {
            font-style: italic;
            color: #cccccc;
            margin-top: 5px;
            font-size: 0.85em;
        }
        .dynamic-controls {
            display: none;
        }
        .dynamic-controls.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>MSTR BTC Leverage Simulator</h1>
        <div class="controls">
            <div class="control-group">
                <label>
                    <input type="checkbox" id="dynamicMode" onchange="toggleDynamicMode()">
                    Enable Dynamic Mode (Adjusts leverage based on BTC price and fixed obligations)
                </label>
            </div>
            <div class="control-group dynamic-controls">
                <label for="btcPriceSlider">BTC Price (USD): 
                    <span class="instruction">The current price of Bitcoin ($20k-$300k). Higher prices lower effective leverage by increasing NAV, reducing the BTC Factor; lower prices increase leverage, amplifying it.</span>
                </label>
                <input type="range" id="btcPriceSlider" min="20000" max="300000" value="112000" oninput="updateSlider('btcPrice')">
                <input type="number" id="btcPrice" min="20000" value="112000" oninput="updateFromNumber('btcPriceSlider')">
                <div class="value-display" id="btcPriceValue">$112,000</div>
            </div>
            <div class="control-group dynamic-controls">
                <label for="debtPreferredSlider">Debt + Preferred Stock (USD): 
                    <span class="instruction">MSTR's fixed obligations (~$12.8B as of Q2 2025). Higher values increase effective leverage, boosting the BTC Factor but raising risk.</span>
                </label>
                <input type="range" id="debtPreferredSlider" min="0" max="50000000000" value="12800000000" step="1000000000" oninput="updateSlider('debtPreferred')">
                <input type="number" id="debtPreferred" min="0" value="12800000000" step="1000000000" oninput="updateFromNumber('debtPreferredSlider')">
                <div class="value-display" id="debtPreferredValue">$12.8B</div>
            </div>
            <div class="control-group">
                <label for="btcArrSlider">BTC ARR (%): 
                    <span class="instruction">The annualized return rate for Bitcoin (0-100%). Higher ARR increases the BTC Factor by assuming faster BTC price growth, amplifying leverage's effect.</span>
                </label>
                <input type="range" id="btcArrSlider" min="0" max="100" value="30" oninput="updateSlider('btcArr')">
                <input type="number" id="btcArr" min="0" value="30" oninput="updateFromNumber('btcArrSlider')">
                <div class="value-display" id="btcArrValue">30%</div>
            </div>
            <div class="control-group">
                <label for="leverageSlider">Leverage (%): 
                    <span class="instruction">The target percentage of borrowed capital used (0-100%). In Dynamic Mode, this is overridden by calculated leverage; otherwise, itâ€™s fixed.</span>
                </label>
                <input type="range" id="leverageSlider" min="0" max="100" value="30" oninput="updateSlider('leverage')">
                <input type="number" id="leverage" min="0" value="30" oninput="updateFromNumber('leverageSlider')">
                <div class="value-display" id="leverageValue">30%</div>
            </div>
            <div class="control-group">
                <label for="dividendRateSlider">Dividend Rate (%): 
                    <span class="instruction">The financing cost for leverage (0-20%). Higher rates decrease the BTC Factor by raising the cost of capital, reducing net amplification.</span>
                </label>
                <input type="range" id="dividendRateSlider" min="0" max="20" value="8" step="0.1" oninput="updateSlider('dividendRate')">
                <input type="number" id="dividendRate" min="0" value="8" step="0.1" oninput="updateFromNumber('dividendRateSlider')">
                <div class="value-display" id="dividendRateValue">8%</div>
            </div>
            <div class="control-group">
                <label for="durationSlider">Duration (Years): 
                    <span class="instruction">The time horizon for compounding (1-30 years). Longer durations increase the BTC Factor through exponential growth of leveraged returns.</span>
                </label>
                <input type="range" id="durationSlider" min="1" max="30" value="10" oninput="updateSlider('duration')">
                <input type="number" id="duration" min="1" value="10" oninput="updateFromNumber('durationSlider')">
                <div class="value-display" id="durationValue">10</div>
            </div>
        </div>
        <div class="selected-factor">
            Selected BTC Factor: <span id="selectedFactor">2.8x</span> (for ARR <span id="selectedArr">30%</span>, Leverage <span id="selectedLeverage">30%</span>, Dividend <span id="selectedDividend">8%</span>, Duration <span id="selectedDuration">10 years</span>)
        </div>
        <div class="result">
            <table id="btcTable">
                <caption>BTC Factor Reference Grid (Updated by Dividend and Duration)</caption>
                <thead>
                    <tr>
                        <th>BTC ARR %</th>
                        <th>0%</th>
                        <th>20%</th>
                        <th>40%</th>
                        <th>60%</th>
                        <th>80%</th>
                        <th>100%</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><th>0%</th><td>1.0x</td><td>1.0x</td><td>1.0x</td><td>1.0x</td><td>1.0x</td><td>1.0x</td></tr>
                    <tr><th>20%</th><td>1.0x</td><td>1.6x</td><td>2.5x</td><td>3.9x</td><td>5.9x</td><td>8.6x</td></tr>
                    <tr><th>40%</th><td>1.0x</td><td>2.2x</td><td>4.8x</td><td>10.3x</td><td>20.9x</td><td>41.0x</td></tr>
                    <tr><th>60%</th><td>1.0x</td><td>2.6x</td><td>6.9x</td><td>18.2x</td><td>46.0x</td><td>113.0x</td></tr>
                    <tr><th>80%</th><td>1.0x</td><td>3.0x</td><td>9.1x</td><td>27.0x</td><td>78.5x</td><td>224.0x</td></tr>
                    <tr><th>100%</th><td>1.0x</td><td>3.4x</td><td>11.5x</td><td>38.0x</td><td>123.0x</td><td>394.0x</td></tr>
                </tbody>
            </table>
            <p>*Values rounded for display. Toggle Dynamic Mode to adjust leverage based on BTC price and fixed obligations.</p>
        </div>
    </div>

    <script>
        const arrValues = [0, 20, 40, 60, 80, 100];
        const levValues = [0, 20, 40, 60, 80, 100];
        const btcHoldings = 640031; // 640,031 BTC as of Q3 2025
        const navPremium = 1.5; // Assumed market premium to NAV

        function calculateFactor(arr, lev, divRate, duration, effectiveLeverage = null) {
            const a = arr / 100;
            const d = divRate / 100;
            let l = effectiveLeverage !== null ? effectiveLeverage / 100 : lev / 100;
            const basePremium = 0.08;
            const growthRate = l * (a + basePremium + l * a - d);
            const effectiveRate = 1 + growthRate;
            const factor = Math.pow(effectiveRate, duration);
            return (factor < 1 ? 1.0 : factor).toFixed(1);
        }

        function calculateDynamicLeverage(btcPrice, debtPreferred) {
            const btcNav = btcHoldings * btcPrice;
            const marketCap = btcNav * navPremium;
            return (debtPreferred / marketCap) * 100;
        }

        function updateSlider(id) {
            const slider = document.getElementById(id + 'Slider');
            const number = document.getElementById(id);
            number.value = slider.value;
            updateTable();
        }

        function updateFromNumber(id) {
            const slider = document.getElementById(id + 'Slider');
            const number = document.getElementById(id);
            slider.value = number.value;
            updateTable();
        }

        function toggleDynamicMode() {
            const dynamicControls = document.querySelectorAll('.dynamic-controls');
            const dynamicMode = document.getElementById('dynamicMode').checked;
            dynamicControls.forEach(control => control.classList.toggle('active', dynamicMode));
            updateTable();
        }

        function updateTable() {
            const btcArr = parseFloat(document.getElementById('btcArr').value);
            const leverage = parseFloat(document.getElementById('leverage').value);
            const dividendRate = parseFloat(document.getElementById('dividendRate').value);
            const duration = parseFloat(document.getElementById('duration').value);
            const dynamicMode = document.getElementById('dynamicMode').checked;
            let btcPrice = 112000;
            let debtPreferred = 12800000000;
            let effectiveLeverage = leverage;

            if (dynamicMode) {
                btcPrice = parseFloat(document.getElementById('btcPrice').value);
                debtPreferred = parseFloat(document.getElementById('debtPreferred').value);
                effectiveLeverage = calculateDynamicLeverage(btcPrice, debtPreferred);
                document.getElementById('leverageValue').textContent = effectiveLeverage.toFixed(1) + '%';
                document.getElementById('btcPriceValue').textContent = '$' + btcPrice.toLocaleString();
                document.getElementById('debtPreferredValue').textContent = '$' + (debtPreferred / 1000000000).toFixed(1) +
