<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSTR BTC Leverage Simulator</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #000000;
            color: #f7931a;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        h1 {
            text-align: center;
            color: #f7931a;
            text-shadow: 0 0 10px #f7931a;
            margin-bottom: 20px;
            font-size: 2.5em;
        }
        .container {
            background: #1a1a1a;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(247, 147, 26, 0.3);
            width: 100%;
            max-width: 900px;
        }
        .controls {
            margin-bottom: 30px;
        }
        .control-group {
            margin-bottom: 25px;
            padding: 15px;
            background: #2a2a2a;
            border-radius: 10px;
            border: 1px solid #f7931a;
        }
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #f7931a;
            font-size: 1.1em;
        }
        input[type="range"], input[type="number"], input[type="checkbox"] {
            width: 100%;
            margin-bottom: 10px;
            accent-color: #f7931a;
        }
        .value-display {
            font-size: 1.2em;
            color: #ffffff;
            font-weight: bold;
            text-align: center;
            padding: 5px;
            background: #333333;
            border-radius: 5px;
            display: inline-block;
        }
        .selected-factor {
            background: #333333;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.5em;
            color: #f7931a;
            border: 1px solid #f7931a;
        }
        .selected-factor span {
            color: #ffffff;
            font-weight: bold;
        }
        .result {
            padding: 20px;
            border-radius: 10px;
            background: #2a2a2a;
            border: 1px solid #f7931a;
            overflow-x: auto;
        }
        table {
            width: 100%;
            min-width: 600px;
            border-collapse: collapse;
            margin-top: 15px;
            background: #1a1a1a;
            table-layout: fixed;
        }
        th, td {
            border: 2px solid #f7931a;
            padding: 12px;
            text-align: center;
            color: #e68a00;
            font-weight: bold;
            font-size: 1.0em;
        }
        th {
            background-color: #333333;
            font-size: 1.1em;
        }
        .orange-value {
            background-color: #f7931a;
            color: #000000;
            font-weight: bold;
        }
        .yellow-value {
            background-color: #ffff00;
            color: #000000;
            font-weight: bold;
        }
        caption {
            font-weight: bold;
            margin-bottom: 10px;
            color: #f7931a;
            font-size: 1.2em;
        }
        p {
            color: #ffffff;
            font-size: 0.9em;
            margin-top: 10px;
        }
        .instruction {
            font-style: italic;
            color: #cccccc;
            margin-top: 5px;
            font-size: 0.85em;
        }
        .dynamic-controls {
            display: none;
        }
        .dynamic-controls.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>MSTR BTC Leverage Simulator</h1>
        <div class="controls">
            <div class="control-group">
                <label>
                    <input type="checkbox" id="dynamicMode" onchange="toggleDynamicMode()">
                    Enable Dynamic Mode (Adjusts leverage based on BTC price)
                </label>
            </div>
            <div class="control-group dynamic-controls">
                <label for="btcPriceSlider">BTC Price (USD): 
                    <span class="instruction">The current price of Bitcoin ($30k-$150k). Higher prices lower effective leverage, reducing the BTC Factor; lower prices increase leverage, amplifying it.</span>
                </label>
                <input type="range" id="btcPriceSlider" min="30000" max="150000" value="73000" oninput="updateSlider('btcPrice')">
                <input type="number" id="btcPrice" min="30000" value="73000" oninput="updateFromNumber('btcPriceSlider')">
                <div class="value-display" id="btcPriceValue">$73,000</div>
            </div>
            <div class="control-group">
                <label for="btcArrSlider">BTC ARR (%): 
                    <span class="instruction">The annualized return rate for Bitcoin (0-100%). Higher ARR increases the BTC Factor by assuming faster BTC price growth, amplifying leverage's effect.</span>
                </label>
                <input type="range" id="btcArrSlider" min="0" max="100" value="30" oninput="updateSlider('btcArr')">
                <input type="number" id="btcArr" min="0" value="30" oninput="updateFromNumber('btcArrSlider')">
                <div class="value-display" id="btcArrValue">30%</div>
            </div>
            <div class="control-group">
                <label for="leverageSlider">Leverage (%): 
                    <span class="instruction">The target percentage of borrowed capital used (0-100%). In Dynamic Mode, this adjusts based on BTC price and fixed debt; otherwise, itâ€™s fixed.</span>
                </label>
                <input type="range" id="leverageSlider" min="0" max="100" value="30" oninput="updateSlider('leverage')">
                <input type="number" id="leverage" min="0" value="30" oninput="updateFromNumber('leverageSlider')">
                <div class="value-display" id="leverageValue">30%</div>
            </div>
            <div class="control-group">
                <label for="dividendRateSlider">Dividend Rate (%): 
                    <span class="instruction">The financing cost for leverage (0-20%). Higher rates decrease the BTC Factor by raising the cost of capital, reducing net amplification.</span>
                </label>
                <input type="range" id="dividendRateSlider" min="0" max="20" value="8" step="0.1" oninput="updateSlider('dividendRate')">
                <input type="number" id="dividendRate" min="0" value="8" step="0.1" oninput="updateFromNumber('dividendRateSlider')">
                <div class="value-display" id="dividendRateValue">8%</div>
            </div>
            <div class="control-group">
                <label for="durationSlider">Duration (Years): 
                    <span class="instruction">The time horizon for compounding (1-30 years). Longer durations increase the BTC Factor through exponential growth of leveraged returns.</span>
                </label>
                <input type="range" id="durationSlider" min="1" max="30" value="10" oninput="updateSlider('duration')">
                <input type="number" id="duration" min="1" value="10" oninput="updateFromNumber('durationSlider')">
                <div class="value-display" id="durationValue">10</div>
            </div>
        </div>
        <div class="selected-factor">
            Selected BTC Factor: <span id="selectedFactor">2.8x</span> (for ARR <span id="selectedArr">30%</span>, Leverage <span id="selectedLeverage">30%</span>, Dividend <span id="selectedDividend">8%</span>, Duration <span id="selectedDuration">10 years</span>)
        </div>
        <div class="result">
            <table id="btcTable">
                <caption>BTC Factor Reference Grid (Updated by Dividend and Duration)</caption>
                <thead>
                    <tr>
                        <th>BTC ARR %</th>
                        <th>0%</th>
                        <th>20%</th>
                        <th>40%</th>
                        <th>60%</th>
                        <th>80%</th>
                        <th>100%</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><th>0%</th><td>1.0x</td><td>1.0x</td><td>1.0x</td><td>1.0x</td><td>1.0x</td><td>1.0x</td></tr>
                    <tr><th>20%</th><td>1.0x</td><td>1.6x</td><td>2.5x</td><td>3.9x</td><td>5.9x</td><td>8.6x</td></tr>
                    <tr><th>40%</th><td>1.0x</td><td>2.2x</td><td>4.8x</td><td>10.3x</td><td>20.9x</td><td>41.0x</td></tr>
                    <tr><th>60%</th><td>1.0x</td><td>2.6x</td><td>6.9x</td><td>18.2x</td><td>46.0x</td><td>113.0x</td></tr>
                    <tr><th>80%</th><td>1.0x</td><td>3.0x</td><td>9.1x</td><td>27.0x</td><td>78.5x</td><td>224.0x</td></tr>
                    <tr><th>100%</th><td>1.0x</td><td>3.4x</td><td>11.5x</td><td>38.0x</td><td>123.0x</td><td>394.0x</td></tr>
                </tbody>
            </table>
            <p>*Values rounded for display. Toggle Dynamic Mode to adjust leverage based on BTC price.</p>
        </div>
    </div>

    <script>
        const arrValues = [0, 20, 40, 60, 80, 100];
        const levValues = [0, 20, 40, 60, 80, 100];
        const fixedDebtPreferred = 12800000000; // $12.8B fixed debt + preferred
        const btcHoldings = 640031; // 640,031 BTC as of Q3 2025

        function calculateFactor(arr, lev, divRate, duration, dynamicLeverage = null) {
            const a = arr / 100;
            const d = divRate / 100;
            let l;
            if (dynamicLeverage !== null) {
                l = dynamicLeverage / 100;
            } else {
                l = lev / 100;
            }
            const basePremium = 0.08;
            const growthRate = l * (a + basePremium + l * a - d);
            const effectiveRate = 1 + growthRate;
            const factor = Math.pow(effectiveRate, duration);
            return (factor < 1 ? 1.0 : factor).toFixed(1);
        }

        function calculateDynamicLeverage(btcPrice) {
            const btcNav = btcHoldings * btcPrice;
            const marketCap = btcNav * 1.5; // Assuming 1.5x premium to NAV
            return (fixedDebtPreferred / marketCap) * 100;
        }

        function updateSlider(id) {
            const slider = document.getElementById(id + 'Slider');
            const number = document.getElementById(id);
            number.value = slider.value;
            updateTable();
        }

        function updateFromNumber(id) {
            const slider = document.getElementById(id + 'Slider');
            const number = document.getElementById(id);
            slider.value = number.value;
            updateTable();
        }

        function toggleDynamicMode() {
            const dynamicControls = document.querySelector('.dynamic-controls');
            const dynamicMode = document.getElementById('dynamicMode').checked;
            dynamicControls.classList.toggle('active', dynamicMode);
            updateTable();
        }

        function updateTable() {
            const btcArr = parseFloat(document.getElementById('btcArr').value);
            const leverage = parseFloat(document.getElementById('leverage').value);
            const dividendRate = parseFloat(document.getElementById('dividendRate').value);
            const duration = parseFloat(document.getElementById('duration').value);
            const dynamicMode = document.getElementById('dynamicMode').checked;
            let btcPrice = 73000;
            let effectiveLeverage = leverage;

            if (dynamicMode) {
                btcPrice = parseFloat(document.getElementById('btcPrice').value);
                effectiveLeverage = calculateDynamicLeverage(btcPrice);
                document.getElementById('leverageValue').textContent = effectiveLeverage.toFixed(1) + '%';
                document.getElementById('btcPriceValue').textContent = '$' + btcPrice.toLocaleString();
            } else {
                document.getElementById('leverageValue').textContent = leverage + '%';
            }

            document.getElementById('btcArrValue').textContent = btcArr + '%';
            document.getElementById('dividendRateValue').textContent = dividendRate.toFixed(1) + '%';
            document.getElementById('durationValue').textContent = duration;

            const rows = document.querySelectorAll('#btcTable tbody tr');
            const cells = document.querySelectorAll('#btcTable td');
            
            cells.forEach(cell => cell.classList.remove('orange-value', 'yellow-value'));
            
            for (let i = 0; i < arrValues.length; i++) {
                for (let j = 0; j < levValues.length; j++) {
                    const cell = rows[i].querySelectorAll('td')[j];
                    if (cell) {
                        const factor = calculateFactor(arrValues[i], levValues[j], dividendRate, duration, dynamicMode ? calculateDynamicLeverage(btcPrice) : null);
                        cell.textContent = factor + 'x';
                    }
                }
            }
            
            cells.forEach(cell => {
                const value = parseFloat(cell.textContent);
                if (value > 4) {
                    cell.classList.add('yellow-value');
                } else if (value > 2) {
                    cell.classList.add('orange-value');
                }
            });
            
            const selectedFactor = calculateFactor(btcArr, leverage, dividendRate, duration, dynamicMode ? calculateDynamicLeverage(btcPrice) : null);
            document.getElementById('selectedFactor').textContent = selectedFactor + 'x';
            document.getElementById('selectedArr').textContent = btcArr + '%';
            document.getElementById('selectedLeverage').textContent = dynamicMode ? effectiveLeverage.toFixed(1) + '%' : leverage + '%';
            document.getElementById('selectedDividend').textContent = dividendRate.toFixed(1) + '%';
            document.getElementById('selectedDuration').textContent = duration + ' years';
        }

        updateTable();

        document.getElementById('btcArrSlider').addEventListener('input', updateSlider.bind(null, 'btcArr'));
        document.getElementById('leverageSlider').addEventListener('input', updateSlider.bind(null, 'leverage'));
        document.getElementById('dividendRateSlider').addEventListener('input', updateSlider.bind(null, 'dividendRate'));
        document.getElementById('durationSlider').addEventListener('input', updateSlider.bind(null, 'duration'));
        document.getElementById('btcPriceSlider').addEventListener('input', updateSlider.bind(null, 'btcPrice'));
        document.getElementById('btcArr').addEventListener('input', updateFromNumber.bind(null, 'btcArrSlider'));
        document.getElementById('leverage').addEventListener('input', updateFromNumber.bind(null, 'leverageSlider'));
        document.getElementById('dividendRate').addEventListener('input', updateFromNumber.bind(null, 'dividendRateSlider'));
        document.getElementById('duration').addEventListener('input', updateFromNumber.bind(null, 'durationSlider'));
        document.getElementById('btcPrice').addEventListener('input', updateFromNumber.bind(null, 'btcPriceSlider'));
    </script>
</body>
</html>
