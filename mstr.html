<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSTR mNAV Simulator</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #000000;
            color: #f7931a;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        h1 {
            text-align: center;
            color: #f7931a;
            text-shadow: 0 0 10px #f7931a;
            margin-bottom: 20px;
            font-size: 2.5em;
        }
        .container {
            background: #1a1a1a;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(247, 147, 26, 0.3);
            width: 100%;
            max-width: 900px;
        }
        .controls {
            margin-bottom: 30px;
        }
        .control-group {
            margin-bottom: 25px;
            padding: 15px;
            background: #2a2a2a;
            border-radius: 10px;
            border: 1px solid #f7931a;
        }
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #f7931a;
            font-size: 1.1em;
        }
        input[type="range"], input[type="number"], button {
            width: 100%;
            margin-bottom: 10px;
            accent-color: #f7931a;
        }
        button {
            padding: 10px;
            background: #333333;
            border: 1px solid #f7931a;
            color: #f7931a;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
        }
        button:hover {
            background: #2a2a2a;
        }
        .value-display {
            font-size: 1.2em;
            color: #ffffff;
            font-weight: bold;
            text-align: center;
            padding: 5px;
            background: #333333;
            border-radius: 5px;
            display: inline-block;
        }
        .selected-mnav {
            background: #333333;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.5em;
            color: #f7931a;
            border: 1px solid #f7931a;
        }
        .selected-mnav span {
            color: #ffffff;
            font-weight: bold;
        }
        .result {
            padding: 20px;
            border-radius: 10px;
            background: #2a2a2a;
            border: 1px solid #f7931a;
            overflow-x: auto;
        }
        table {
            width: 100%;
            min-width: 600px;
            border-collapse: collapse;
            margin-top: 15px;
            background: #1a1a1a;
            table-layout: fixed;
        }
        th, td {
            border: 2px solid #f7931a;
            padding: 12px;
            text-align: center;
            color: #e68a00;
            font-weight: bold;
            font-size: 1.0em;
        }
        th {
            background-color: #333333;
            font-size: 1.1em;
        }
        .orange-value {
            background-color: #f7931a;
            color: #000000;
            font-weight: bold;
        }
        .yellow-value {
            background-color: #ffff00;
            color: #000000;
            font-weight: bold;
        }
        caption {
            font-weight: bold;
            margin-bottom: 10px;
            color: #f7931a;
            font-size: 1.2em;
        }
        p {
            color: #ffffff;
            font-size: 0.9em;
            margin-top: 10px;
        }
        .instruction {
            font-style: italic;
            color: #cccccc;
            margin-top: 5px;
            font-size: 0.85em;
        }
        .expert-controls {
            display: none;
        }
        .expert-controls.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>MSTR mNAV Simulator</h1>
        <div class="controls">
            <div class="control-group">
                <button id="expertModeToggle">Enable Expert Mode</button>
            </div>
            <div class="control-group expert-controls">
                <label for="btcPriceSlider">BTC Price (USD): 
                    <span class="instruction">Current Bitcoin price ($20k-$300k). Affects NAV and leverage, influencing mNAV.</span>
                </label>
                <input type="range" id="btcPriceSlider" min="20000" max="300000" value="112000" oninput="updateSlider('btcPrice')">
                <input type="number" id="btcPrice" min="20000" value="112000" oninput="updateFromNumber('btcPriceSlider')">
                <div class="value-display" id="btcPriceValue">$112,000</div>
            </div>
            <div class="control-group expert-controls">
                <label for="debtPreferredSlider">Debt + Preferred Stock (USD): 
                    <span class="instruction">MSTR's fixed obligations (default ~$12.8B as of Q2 2025). Higher values increase leverage, raising mNAV potential.</span>
                </label>
                <input type="range" id="debtPreferredSlider" min="0" max="50000000000" value="12800000000" step="1000000000" oninput="updateSlider('debtPreferred')">
                <input type="number" id="debtPreferred" min="0" value="12800000000" step="1000000000" oninput="updateFromNumber('debtPreferredSlider')">
                <div class="value-display" id="debtPreferredValue">$12.8B</div>
            </div>
            <div class="control-group expert-controls">
                <label for="btcHoldingsSlider">BTC Holdings: 
                    <span class="instruction">MSTR's total Bitcoin owned (0-1M BTC, default 640,031 as of Q3 2025). More holdings increase NAV, affecting mNAV.</span>
                </label>
                <input type="range" id="btcHoldingsSlider" min="0" max="1000000" value="640031" oninput="updateSlider('btcHoldings')">
                <input type="number" id="btcHoldings" min="0" value="640031" oninput="updateFromNumber('btcHoldingsSlider')">
                <div class="value-display" id="btcHoldingsValue">640,031</div>
            </div>
            <div class="control-group expert-controls">
                <label for="basePremiumSlider">Base Premium (%): 
                    <span class="instruction">Strategic advantage premium (0-15%, default 8%). Higher values boost mNAV by increasing assumed growth.</span>
                </label>
                <input type="range" id="basePremiumSlider" min="0" max="15" value="8" step="0.1" oninput="updateSlider('basePremium')">
                <input type="number" id="basePremium" min="0" value="8" step="0.1" oninput="updateFromNumber('basePremiumSlider')">
                <div class="value-display" id="basePremiumValue">8%</div>
            </div>
            <div class="control-group">
                <label for="btcArrSlider">BTC ARR (%): 
                    <span class="instruction">Annualized return rate for Bitcoin (0-100%). Higher ARR increases mNAV through leveraged growth.</span>
                </label>
                <input type="range" id="btcArrSlider" min="0" max="100" value="30" oninput="updateSlider('btcArr')">
                <input type="number" id="btcArr" min="0" value="30" oninput="updateFromNumber('btcArrSlider')">
                <div class="value-display" id="btcArrValue">30%</div>
            </div>
            <div class="control-group">
                <label for="leverageSlider">Leverage (%): 
                    <span class="instruction">Target borrowed capital percentage (0-100%). In Expert Mode, overridden by calculated leverage; otherwise, fixed.</span>
                </label>
                <input type="range" id="leverageSlider" min="0" max="100" value="30" oninput="updateSlider('leverage')">
                <input type="number" id="leverage" min="0" value="30" oninput="updateFromNumber('leverageSlider')">
                <div class="value-display" id="leverageValue">30%</div>
            </div>
            <div class="control-group">
                <label for="dividendRateSlider">Dividend Rate (%): 
                    <span class="instruction">Financing cost for leverage (0-20%). Higher rates decrease mNAV by raising costs.</span>
                </label>
                <input type="range" id="dividendRateSlider" min="0" max="20" value="8" step="0.1" oninput="updateSlider('dividendRate')">
                <input type="number" id="dividendRate" min="0" value="8" step="0.1" oninput="updateFromNumber('dividendRateSlider')">
                <div class="value-display" id="dividendRateValue">8%</div>
            </div>
            <div class="control-group">
                <label for="durationSlider">Duration (Years): 
                    <span class="instruction">Time horizon for compounding (1-30 years). Longer durations increase mNAV through leveraged returns.</span>
                </label>
                <input type="range" id="durationSlider" min="1" max="30" value="10" oninput="updateSlider('duration')">
                <input type="number" id="duration" min="1" value="10" oninput="updateFromNumber('durationSlider')">
                <div class="value-display" id="durationValue">10</div>
            </div>
        </div>
        <div class="selected-mnav">
            Selected mNAV: <span id="selectedMNAV">1.5x</span> (for ARR <span id="selectedArr">30%</span>, Leverage <span id="selectedLeverage">30%</span>, Dividend <span id="selectedDividend">8%</span>, Duration <span id="selectedDuration">10 years</span>)
        </div>
        <div class="result">
            <table id="mnavTable">
                <caption>mNAV Reference Grid (Updated by Dividend and Duration)</caption>
                <thead>
                    <tr>
                        <th>BTC ARR %</th>
                        <th>0%</th>
                        <th>20%</th>
                        <th>40%</th>
                        <th>60%</th>
                        <th>80%</th>
                        <th>100%</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><th>0%</th><td>1.0x</td><td>1.0x</td><td>1.0x</td><td>1.0x</td><td>1.0x</td><td>1.0x</td></tr>
                    <tr><th>20%</th><td>1.0x</td><td>1.3x</td><td>1.6x</td><td>2.0x</td><td>2.4x</td><td>2.8x</td></tr>
                    <tr><th>40%</th><td>1.0x</td><td>1.4x</td><td>1.9x</td><td>2.5x</td><td>3.2x</td><td>3.9x</td></tr>
                    <tr><th>60%</th><td>1.0x</td><td>1.5x</td><td>2.1x</td><td>2.9x</td><td>3.8x</td><td>4.7x</td></tr>
                    <tr><th>80%</th><td>1.0x</td><td>1.6x</td><td>2.3x</td><td>3.3x</td><td>4.4x</td><td>5.5x</td></tr>
                    <tr><th>100%</th><td>1.0x</td><td>1.7x</td><td>2.5x</td><td>3.7x</td><td>5.0x</td><td>6.3x</td></tr>
                </tbody>
            </table>
            <p>*Values are approximate mNAV estimates based on leverage effect over time. Toggle Expert Mode for dynamic adjustments.</p>
        </div>
    </div>

    <script>
        const arrValues = [0, 20, 40, 60, 80, 100];
        const levValues = [0, 20, 40, 60, 80, 100];

        function calculateMNAV(arr, lev, divRate, duration, basePremium, effectiveLeverage = null) {
            const a = arr / 100;
            const d = divRate / 100;
            let l = effectiveLeverage !== null ? effectiveLeverage / 100 : lev / 100;
            const netReturn = a - d + (basePremium / 100);
            const growthRate = l * netReturn;
            const mnavBase = 1.0; // Starting mNAV without leverage effect
            const mnavAdjustment = growthRate * (Math.min(duration, 10) / 10); // Scale effect, capped at 10 years
            const mnav = mnavBase + mnavAdjustment;
            return (mnav < 1.0 ? 1.0 : mnav).toFixed(1); // Ensure mNAV doesn't go below 1.0x
        }

        function calculateDynamicLeverage(btcPrice, debtPreferred, btcHoldings) {
            const nav = btcHoldings * btcPrice - debtPreferred; // NAV adjusted for liabilities
            const impliedMarketCap = nav * 1.5; // Initial guess at mNAV = 1.5x (current market trend)
            return (debtPreferred / impliedMarketCap) * 100;
        }

        function updateSlider(id) {
            const slider = document.getElementById(id + 'Slider');
            const number = document.getElementById(id);
            number.value = slider.value;
            updateTable();
        }

        function updateFromNumber(id) {
            const slider = document.getElementById(id + 'Slider');
            const number = document.getElementById(id);
            slider.value = number.value;
            updateTable();
        }

        function toggleExpertMode() {
            const expertControls = document.querySelectorAll('.expert-controls');
            const button = document.getElementById('expertModeToggle');
            const isActive = button.textContent === 'Disable Expert Mode';
            button.textContent = isActive ? 'Enable Expert Mode' : 'Disable Expert Mode';
            expertControls.forEach(control => control.classList.toggle('active', !isActive));
            updateTable();
        }

        function updateTable() {
            const btcArr = parseFloat(document.getElementById('btcArr').value);
            const leverage = parseFloat(document.getElementById('leverage').value);
            const dividendRate = parseFloat(document.getElementById('dividendRate').value);
            const duration = parseFloat(document.getElementById('duration').value);
            const button = document.getElementById('expertModeToggle');
            const expertMode = button.textContent === 'Disable Expert Mode';
            let btcPrice = 112000;
            let debtPreferred = 12800000000;
            let btcHoldings = 640031;
            let basePremium = 8;
            let effectiveLeverage = leverage;

            if (expertMode) {
                btcPrice = parseFloat(document.getElementById('btcPrice').value);
                debtPreferred = parseFloat(document.getElementById('debtPreferred').value);
                btcHoldings = parseFloat(document.getElementById('btcHoldings').value);
                basePremium = parseFloat(document.getElementById('basePremium').value);
                effectiveLeverage = calculateDynamicLeverage(btcPrice, debtPreferred, btcHoldings);
                document.getElementById('leverageValue').textContent = effectiveLeverage.toFixed(1) + '%';
                document.getElementById('btcPriceValue').textContent = '$' + btcPrice.toLocaleString();
                document.getElementById('debtPreferredValue').textContent = '$' + (debtPreferred / 1000000000).toFixed(1) + 'B';
                document.getElementById('btcHoldingsValue').textContent = btcHoldings.toLocaleString();
                document.getElementById('basePremiumValue').textContent = basePremium.toFixed(1) + '%';
            } else {
                document.getElementById('leverageValue').textContent = leverage + '%';
            }

            document.getElementById('btcArrValue').textContent = btcArr + '%';
            document.getElementById('dividendRateValue').textContent = dividendRate.toFixed(1) + '%';
            document.getElementById('durationValue').textContent = duration;

            const rows = document.querySelectorAll('#mnavTable tbody tr');
            const cells = document.querySelectorAll('#mnavTable td');
            
            cells.forEach(cell => cell.classList.remove('orange-value', 'yellow-value'));
            
            for (let i = 0; i < arrValues.length; i++) {
                for (let j = 0; j < levValues.length; j++) {
                    const cell = rows[i].querySelectorAll('td')[j];
                    if (cell) {
                        const dynLev = expertMode ? calculateDynamicLeverage(btcPrice, debtPreferred, btcHoldings) : null;
                        const mnav = calculateMNAV(arrValues[i], levValues[j], dividendRate, duration, basePremium, dynLev);
                        cell.textContent = mnav + 'x';
                    }
                }
            }
            
            cells.forEach(cell => {
                const value = parseFloat(cell.textContent);
                if (value > 4) {
                    cell.classList.add('yellow-value');
                } else if (value > 2) {
                    cell.classList.add('orange-value');
                }
            });
            
            const dynLev = expertMode ? calculateDynamicLeverage(btcPrice, debtPreferred, btcHoldings) : null;
            const selectedMNAV = calculateMNAV(btcArr, leverage, dividendRate, duration, basePremium, dynLev);
            document.getElementById('selectedMNAV').textContent = selectedMNAV + 'x';
            document.getElementById('selectedArr').textContent = btcArr + '%';
            document.getElementById('selectedLeverage').textContent = expertMode ? effectiveLeverage.toFixed(1) + '%' : leverage + '%';
            document.getElementById('selectedDividend').textContent = dividendRate.toFixed(1) + '%';
            document.getElementById('selectedDuration').textContent = duration + ' years';
        }

        updateTable();

        // Event listeners
        document.getElementById('expertModeToggle').addEventListener('click', toggleExpertMode);
        document.getElementById('btcArrSlider').addEventListener('input', () => updateSlider('btcArr'));
        document.getElementById('leverageSlider').addEventListener('input', () => updateSlider('leverage'));
        document.getElementById('dividendRateSlider').addEventListener('input', () => updateSlider('dividendRate'));
        document.getElementById('durationSlider').addEventListener('input', () => updateSlider('duration'));
        document.getElementById('btcPriceSlider').addEventListener('input', () => updateSlider('btcPrice'));
        document.getElementById('debtPreferredSlider').addEventListener('input', () => updateSlider('debtPreferred'));
        document.getElementById('btcHoldingsSlider').addEventListener('input', () => updateSlider('btcHoldings'));
        document.getElementById('basePremiumSlider').addEventListener('input', () => updateSlider('basePremium'));
        document.getElementById('btcArr').addEventListener('input', () => updateFromNumber('btcArrSlider'));
        document.getElementById('leverage').addEventListener('input', () => updateFromNumber('leverageSlider'));
        document.getElementById('dividendRate').addEventListener('input', () => updateFromNumber('dividendRateSlider'));
        document.getElementById('duration').addEventListener('input', () => updateFromNumber('durationSlider'));
        document.getElementById('btcPrice').addEventListener('input', () => updateFromNumber('btcPriceSlider'));
        document.getElementById('debtPreferred').addEventListener('input', () => updateFromNumber('debtPreferredSlider'));
        document.getElementById('btcHoldings').addEventListener('input', () => updateFromNumber('btcHoldingsSlider'));
        document.getElementById('basePremium').addEventListener('input', () => updateFromNumber('basePremiumSlider'));
    </script>
</body>
</html>
